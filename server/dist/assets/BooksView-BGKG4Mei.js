import{a as k}from"./api-UILreyrV.js";import{_ as B,c as l,a as t,d as m,n as b,e as v,F as _,r as f,f as S,T as w,o as n,t as a,b as I,w as y,v as N}from"./index-Dew-Clkf.js";const p="book";class h{static queryBook(e){return k.get(p,{params:{query:e}})}static allBooks(){return this.queryBook("*")}static postBook(e,c){return k.post(p,{key:e,value:c})}}const O=["B11401090","B12902099","B12705035","B09502091","B13303034","0"],g={name:"BooksView",data(){return{booksData:"",booksKey:[],selectedBook:null,selectedBookIndex:null,page:1,containerWidth:0,userId:""}},computed:{gridColumns(){const o=this.containerWidth>768?250:200,e=this.containerWidth*.02,c=this.selectedBook?this.containerWidth*.7:this.containerWidth,u=Math.floor((c+e)/(o+e));return`repeat(${Math.max(2,Math.min(8,u))}, ${o}px)`}},methods:{selectBook(o,e){this.selectedBook=o,this.selectedBookIndex=e},updateContainerWidth(){this.$refs.container&&(this.containerWidth=this.$refs.container.offsetWidth)},scrollToItem(o){const e=this.$refs[`bookItem-${o}`][0];e&&e.scrollIntoView({behavior:"smooth"})},closeDetails(){this.selectedBook=null},scrollToSelectedItem(){this.scrollToItem(this.selectedBookIndex)},async sendBorrowRequest(){if(O.includes(this.userId)){var o={isbn:JSON.parse(this.selectedBook).isbn,title:JSON.parse(this.selectedBook).title,cover:JSON.parse(this.selectedBook).cover,author:JSON.parse(this.selectedBook).author,publisher:JSON.parse(this.selectedBook).publisher,date:JSON.parse(this.selectedBook).data,place:JSON.parse(this.selectedBook).place,borrow:this.userId};await h.postBook(this.selectedBookIndex,JSON.stringify(o)),this.booksData=await h.allBooks(),this.booksKey=Object.keys(this.booksData),this.userId="",this.closeDetails()}}},async mounted(){this.booksData=await h.allBooks(),this.booksKey=Object.keys(this.booksData),this.updateContainerWidth(),window.addEventListener("resize",this.updateContainerWidth)},beforeUnmount(){window.removeEventListener("resize",this.updateContainerWidth)}},J={class:"handleScroll"},C={class:"grid-container",id:"split-container"},W={id:"bookshelf"},x={class:"books-container",ref:"container"},D=["onClick"],T={class:"product-thumbnail"},V=["src"],q={class:"product-title"},z={class:"text"},E={key:0,class:"details-panel"},L={class:"details-content"},M=["src","alt"],R={key:0},U={key:1},K={class:"borrow-section"};function j(o,e,c,u,s,r){return n(),l("div",J,[t("div",C,[t("section",W,[t("div",x,[t("div",{class:b(["grid-wrapper",{"with-details":s.selectedBook}]),ref:"gridWrapper"},[t("div",{class:"product-list",style:v({gridTemplateColumns:r.gridColumns})},[(n(!0),l(_,null,f(s.booksData,(i,d)=>(n(),l("button",{class:"product-card",key:d,ref_for:!0,ref:`bookItem-${d}`,onClick:A=>r.selectBook(i,d)},[t("div",T,[t("img",{loading:"lazy",src:JSON.parse(i).cover},null,8,V)]),t("div",q,[t("div",z,a(JSON.parse(i).title),1)])],8,D))),128))],4)],2),m(w,{name:"details-slide",onAfterEnter:e[3]||(e[3]=i=>r.scrollToSelectedItem()),onAfterLeave:e[4]||(e[4]=i=>r.scrollToSelectedItem())},{default:S(()=>[s.selectedBook?(n(),l("div",E,[t("div",L,[t("button",{onClick:e[0]||(e[0]=i=>r.closeDetails()),class:"close-btn"}," × "),t("img",{src:JSON.parse(s.selectedBook).cover,alt:JSON.parse(s.selectedBook).title,class:"large-image"},null,8,M),t("h2",null,a(JSON.parse(s.selectedBook).title),1),t("p",null," 作者："+a(JSON.parse(s.selectedBook).author),1),t("p",null," 出版社："+a(JSON.parse(s.selectedBook).publisher),1),t("p",null," 位置："+a(JSON.parse(s.selectedBook).place),1),JSON.parse(s.selectedBook).borrow=="0"?(n(),l("p",R," 狀態：可借閱 ")):(n(),l("p",U,"狀態：不可借閱")),t("div",K,[y(t("input",{type:"text",id:"userId","onUpdate:modelValue":e[1]||(e[1]=i=>s.userId=i),placeholder:"請輸入您的用戶ID",class:"user-id-input"},null,512),[[N,s.userId]]),t("button",{onClick:e[2]||(e[2]=(...i)=>r.sendBorrowRequest&&r.sendBorrowRequest(...i)),class:"borrow-btn"}," 借閱 ")])])])):I("",!0)]),_:1})],512)])])])}const H=B(g,[["render",j]]);export{H as default};
