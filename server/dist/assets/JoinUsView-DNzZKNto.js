import{r as y}from"./reviewsService-B0zCigq7.js";import{r as _}from"./recordService-DoMX_8kY.js";import{_ as B,c as a,a as s,p as S,g as L,w,v as b,t as l,b as u,m as f,F as p,r as k,l as I,f as d,i as h,k as v}from"./index-DvbrtFgp.js";import"./api-C3PXPV91.js";const D={name:"JoinUsView",data(){return{isLoggedIn:!1,loginLoading:!1,loginError:null,loginForm:{email:"",password:""},currentUser:null,activeTab:"borrowed",borrowedBooks:[{title:"Sample Book"},{title:"Another Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"}],borrowingHistory:[{title:"Past Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"}],borrowCount:{borrowingHistory:0,borrowedBooks:0},totalCount:0}},methods:{async login(){try{this.loginLoading=!0,this.loginError=null;const t=await y.login(this.loginForm.email,this.loginForm.password);t.success?(this.isLoggedIn=!0,this.currentUser=t.data.user,localStorage.setItem("currentUser",JSON.stringify(t.data.user)),localStorage.setItem("isLoggedIn","true"),await this.loadBorrowingRecords()):this.loginError=t.error||"Login failed"}catch(t){console.error("Login error:",t),this.loginError="Login failed. Please check your credentials and try again."}finally{this.loginLoading=!1}},logout(){this.isLoggedIn=!1,this.currentUser=null,this.loginForm={email:"",password:""},this.loginError=null,localStorage.removeItem("currentUser"),localStorage.removeItem("isLoggedIn")},signUp(){window.open("https://www.google.com","_blank")},checkLoginStatus(){const t=localStorage.getItem("currentUser"),o=localStorage.getItem("isLoggedIn");t&&o==="true"&&(this.isLoggedIn=!0,this.currentUser=JSON.parse(t),this.loadBorrowingRecords())},async loadBorrowingRecords(){if(this.currentUser){try{const o=(await _.allRecords()).filter(i=>i.userId===this.currentUser._id);this.borrowedBooks=o.filter(i=>i.status==="borrowed"),this.borrowingHistory=o.filter(i=>i.status==="returned")}catch(t){console.error("Failed to load borrowing records:",t)}this.initAttributes()}},calculateDaysBorrowed(t){const o=new Date,i=new Date(t),c=Math.abs(o-i);return Math.ceil(c/(1e3*60*60*24))},calculateBorrowDuration(t,o){const i=new Date(t),c=new Date(o),e=Math.abs(c-i);return Math.ceil(e/(1e3*60*60*24))},formatDate(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})},setFormatSpan(t){var o={};return o.style={"grid-column":`span ${t==="borrowedBooks"?this.borrowedBooks.length:this.borrowingHistory.length}`},o},countRecords(){this.borrowCount.borrowedBooks=this.borrowedBooks.length,this.borrowCount.borrowingHistory=this.borrowingHistory.length,this.totalCount=this.borrowCount.borrowedBooks+this.borrowCount.borrowingHistory},initAttributes(){this.countRecords();const t=document.querySelector(".sep-line"),o=200,i=10,c=(o+i)*(this.totalCount+1)-i;t.style.width=`calc(${c}px - 63.2px)`}},mounted(){this.checkLoginStatus()}},F={class:"join-us-container"},U={key:0,class:"login-section"},C={class:"login-form"},x={class:"form-group"},H=["disabled"],M={class:"form-group"},R=["disabled"],O=["disabled"],E={key:0},N={key:1},A={key:0,class:"error-message"},T={key:1,class:"welcome-section"},q={class:"profile-info-grid"},J={class:"profile-info-content name"},P={class:"profile-info-content nickname"},V={class:"profile-info-content email"},G={class:"profile-info-content password"},j={class:"borrow-history-grid"},Q={class:"reviews-container"},W={class:"review-item"},Y={class:"review-title"},z={class:"borrow-date-info"},X={class:"borrow-date"},Z={class:"days-borrowed"},K={class:"return-borrow-button"},$={class:"book-actions"},oo={class:"review-title"},so={class:"borrow-date-info"},to={class:"borrow-date"},eo={class:"days-borrowed"},ro={class:"return-borrow-button"},io={class:"book-actions"},no=["disabled"];function lo(t,o,i,c,e,n){const m=I("router-link");return d(),a("div",F,[e.isLoggedIn?(d(),a("div",T,[s("div",q,[o[9]||(o[9]=s("div",{class:"profile-info-title name"},"Name",-1)),s("div",J,l(e.currentUser.name),1),o[10]||(o[10]=s("div",{class:"profile-info-title nickname"},"Nickname",-1)),s("div",P,l(e.currentUser.nickname),1),o[11]||(o[11]=s("div",{class:"profile-info-title email"},"Email",-1)),s("div",V,l(e.currentUser.email),1),o[12]||(o[12]=s("div",{class:"profile-info-title password"},"Password",-1)),s("div",G,l(e.currentUser.password),1)]),s("div",j,[s("div",Q,[o[17]||(o[17]=s("div",{class:"sep-line"},null,-1)),s("div",W,[s("div",f({class:"work-format"},n.setFormatSpan("borrowedBooks")),o[13]||(o[13]=[s("div",{class:"format-label"},"Borrowing",-1)]),16),(d(!0),a(p,null,k(e.borrowedBooks,(r,g)=>(d(),a("div",{key:g,class:"review-card"},[s("div",Y,l(r.bookTitle),1),s("div",z,[s("span",X,"From: "+l(n.formatDate(r.borrowDate)),1),s("span",Z,"Days Borrowed: "+l(n.calculateDaysBorrowed(r.borrowDate)),1)]),s("div",K,[s("div",$,[h(m,{to:{path:"/books",query:{bookId:r.bookId}},class:"action-link view-book"},{default:v(()=>o[14]||(o[14]=[u(" Return ")])),_:2},1032,["to"])])])]))),128)),s("div",f({class:"work-format"},n.setFormatSpan("borrowingHistory")),o[15]||(o[15]=[s("div",{class:"format-label"},"History",-1)]),16),(d(!0),a(p,null,k(e.borrowingHistory,(r,g)=>(d(),a("div",{key:g,class:"review-card"},[s("div",oo,l(r.bookTitle),1),s("div",so,[s("span",to,"From: "+l(n.formatDate(r.borrowDate)),1),s("span",eo,"To: "+l(n.formatDate(r.returnDate)),1)]),s("div",ro,[s("div",io,[h(m,{to:{path:"/books",query:{bookId:r.bookId}},class:"action-link view-book"},{default:v(()=>o[16]||(o[16]=[u(" Borrow ")])),_:2},1032,["to"])])])]))),128))])]),s("button",{type:"submit",disabled:e.loginLoading,class:"logout-btn",onClick:o[3]||(o[3]=(...r)=>n.logout&&n.logout(...r))},o[18]||(o[18]=[s("span",null,"Log out",-1)]),8,no)])])):(d(),a("div",U,[s("div",C,[s("form",{onSubmit:o[2]||(o[2]=S((...r)=>n.login&&n.login(...r),["prevent"]))},[s("div",x,[o[4]||(o[4]=s("label",{for:"email"},"Email",-1)),w(s("input",{type:"email",id:"email","onUpdate:modelValue":o[0]||(o[0]=r=>e.loginForm.email=r),required:"",disabled:e.loginLoading},null,8,H),[[b,e.loginForm.email]])]),s("div",M,[o[5]||(o[5]=s("label",{for:"password"},"Password",-1)),w(s("input",{type:"password",id:"password","onUpdate:modelValue":o[1]||(o[1]=r=>e.loginForm.password=r),required:"",disabled:e.loginLoading},null,8,R),[[b,e.loginForm.password]])]),s("button",{type:"submit",disabled:e.loginLoading,class:"login-btn"},[e.loginLoading?(d(),a("span",E,o[6]||(o[6]=[s("svg",{class:"spinner",viewBox:"0 0 50 50"},[s("circle",{cx:"25",cy:"25",r:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-dasharray":"31.416","stroke-dashoffset":"31.416"},[s("animate",{attributeName:"stroke-dasharray",dur:"2s",values:"0 31.416;15.708 15.708;0 31.416",repeatCount:"indefinite"}),s("animate",{attributeName:"stroke-dashoffset",dur:"2s",values:"0;-15.708;-31.416",repeatCount:"indefinite"})])],-1)]))):(d(),a("span",N,"Login"))],8,O),o[7]||(o[7]=s("div",{class:"signup-link-container"},[s("a",{class:"signup-link",href:"https://docs.google.com/forms/d/e/1FAIpQLSeMnnXu--cvwh0RYvUioM69FyKIxjIBJW8g2FZG3pxGJs2kJA/viewform?fbclid=IwY2xjawMWw8tleHRuA2FlbQIxMQABHjGqGJ2osPSG4FlPhMAgjST4pOwkObfQz5CgSNqGHBM-a8ZM7Hv069R0ISYh_aem_ieCOFmq-kI2oX2ojcveO1w"},"Sign up")],-1)),e.loginError?(d(),a("div",A,l(e.loginError),1)):L("",!0)],32),o[8]||(o[8]=s("div",{class:"login-help"},[s("p",{class:"demo-info"},[s("strong",null,"Demo Account:"),s("br"),u(" Email: ming.zhang@email.com"),s("br"),u(" Password: $2b$10$encrypted_password_hash ")])],-1))])]))])}const mo=B(D,[["render",lo],["__scopeId","data-v-a5fce730"]]);export{mo as default};
