import{r as y}from"./reviewsService-B3EX-PGw.js";import{r as _}from"./recordService-DoMX_8kY.js";import{_ as B,c as a,a as s,p as S,g as L,w,v as b,t as l,b as u,m as f,F as p,r as k,l as D,f as d,i as h,k as v}from"./index-B0pdlVVf.js";import"./api-C3PXPV91.js";const U={name:"JoinUsView",data(){return{isLoggedIn:!1,loginLoading:!1,loginError:null,loginForm:{email:"",password:""},currentUser:null,activeTab:"borrowed",borrowedBooks:[{title:"Sample Book"},{title:"Another Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"}],borrowingHistory:[{title:"Past Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"}],borrowCount:{borrowingHistory:0,borrowedBooks:0},totalCount:0}},methods:{async login(){try{this.loginLoading=!0,this.loginError=null;const t=await y.login(this.loginForm.email,this.loginForm.password);t.success?(this.isLoggedIn=!0,this.currentUser=t.data.user,localStorage.setItem("currentUser",JSON.stringify(t.data.user)),localStorage.setItem("isLoggedIn","true"),await this.loadBorrowingRecords()):this.loginError=t.error||"Login failed"}catch(t){console.error("Login error:",t),this.loginError="Login failed. Please check your credentials and try again."}finally{this.loginLoading=!1}},logout(){this.isLoggedIn=!1,this.currentUser=null,this.loginForm={email:"",password:""},this.loginError=null,localStorage.removeItem("currentUser"),localStorage.removeItem("isLoggedIn")},signUp(){window.open("https://www.google.com","_blank")},checkLoginStatus(){const t=localStorage.getItem("currentUser"),o=localStorage.getItem("isLoggedIn");t&&o==="true"&&(this.isLoggedIn=!0,this.currentUser=JSON.parse(t),this.loadBorrowingRecords())},async loadBorrowingRecords(){if(this.currentUser){try{const o=(await _.allRecords()).filter(i=>i.userId===this.currentUser._id);this.borrowedBooks=o.filter(i=>i.status==="borrowed"),this.borrowingHistory=o.filter(i=>i.status==="returned")}catch(t){console.error("Failed to load borrowing records:",t)}this.initAttributes()}},calculateDaysBorrowed(t){const o=new Date,i=new Date(t),c=Math.abs(o-i);return Math.ceil(c/(1e3*60*60*24))},calculateBorrowDuration(t,o){const i=new Date(t),c=new Date(o),e=Math.abs(c-i);return Math.ceil(e/(1e3*60*60*24))},formatDate(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})},setFormatSpan(t){var o={};return o.style={"grid-column":`span ${t==="borrowedBooks"?this.borrowedBooks.length:this.borrowingHistory.length}`},o},countRecords(){this.borrowCount.borrowedBooks=this.borrowedBooks.length,this.borrowCount.borrowingHistory=this.borrowingHistory.length,this.totalCount=this.borrowCount.borrowedBooks+this.borrowCount.borrowingHistory},initAttributes(){this.countRecords();const t=document.querySelector(".sep-line"),o=200,i=10,c=(o+i)*(this.totalCount+1)-i;t.style.width=`calc(${c}px - 63.2px)`}},mounted(){this.checkLoginStatus()}},I={class:"join-us-container"},C={key:0,class:"login-section"},F={class:"login-form"},E={class:"form-group"},x=["disabled"],H={class:"form-group"},N=["disabled"],R=["disabled"],O={key:0},T={key:1},V={class:"signup-link-container"},M={key:0,class:"error-message"},P={key:1,class:"welcome-section"},q={class:"profile-info-grid"},A={class:"profile-info-content name"},J={class:"profile-info-content nickname"},W={class:"profile-info-content email"},j={class:"profile-info-content password"},z={class:"borrow-history-grid"},G={class:"reviews-container"},K={class:"review-item"},Q={class:"review-title"},X={class:"borrow-date-info"},Y={class:"borrow-date"},Z={class:"days-borrowed"},$={class:"return-borrow-button"},oo={class:"book-actions"},so={class:"review-title"},to={class:"borrow-date-info"},eo={class:"borrow-date"},ro={class:"days-borrowed"},io={class:"return-borrow-button"},no={class:"book-actions"},lo=["disabled"];function ao(t,o,i,c,e,n){const m=D("router-link");return d(),a("div",I,[e.isLoggedIn?(d(),a("div",P,[s("div",q,[o[9]||(o[9]=s("div",{class:"profile-info-title name"},"Name",-1)),s("div",A,l(e.currentUser.name),1),o[10]||(o[10]=s("div",{class:"profile-info-title nickname"},"Nickname",-1)),s("div",J,l(e.currentUser.nickname),1),o[11]||(o[11]=s("div",{class:"profile-info-title email"},"Email",-1)),s("div",W,l(e.currentUser.email),1),o[12]||(o[12]=s("div",{class:"profile-info-title password"},"Password",-1)),s("div",j,l(e.currentUser.password),1)]),s("div",z,[s("div",G,[o[17]||(o[17]=s("div",{class:"sep-line"},null,-1)),s("div",K,[s("div",f({class:"work-format"},n.setFormatSpan("borrowedBooks")),o[13]||(o[13]=[s("div",{class:"format-label"},"Borrowing",-1)]),16),(d(!0),a(p,null,k(e.borrowedBooks,(r,g)=>(d(),a("div",{key:g,class:"review-card"},[s("div",Q,l(r.bookTitle),1),s("div",X,[s("span",Y,"From: "+l(n.formatDate(r.borrowDate)),1),s("span",Z,"Days Borrowed: "+l(n.calculateDaysBorrowed(r.borrowDate)),1)]),s("div",$,[s("div",oo,[h(m,{to:{path:"/books",query:{bookId:r.bookId}},class:"action-link view-book"},{default:v(()=>o[14]||(o[14]=[u(" Return ")])),_:2},1032,["to"])])])]))),128)),s("div",f({class:"work-format"},n.setFormatSpan("borrowingHistory")),o[15]||(o[15]=[s("div",{class:"format-label"},"History",-1)]),16),(d(!0),a(p,null,k(e.borrowingHistory,(r,g)=>(d(),a("div",{key:g,class:"review-card"},[s("div",so,l(r.bookTitle),1),s("div",to,[s("span",eo,"From: "+l(n.formatDate(r.borrowDate)),1),s("span",ro,"To: "+l(n.formatDate(r.returnDate)),1)]),s("div",io,[s("div",no,[h(m,{to:{path:"/books",query:{bookId:r.bookId}},class:"action-link view-book"},{default:v(()=>o[16]||(o[16]=[u(" Borrow ")])),_:2},1032,["to"])])])]))),128))])]),s("button",{type:"submit",disabled:e.loginLoading,class:"logout-btn",onClick:o[4]||(o[4]=(...r)=>n.logout&&n.logout(...r))},o[18]||(o[18]=[s("span",null,"Log out",-1)]),8,lo)])])):(d(),a("div",C,[s("div",F,[s("form",{onSubmit:o[3]||(o[3]=S((...r)=>n.login&&n.login(...r),["prevent"]))},[s("div",E,[o[5]||(o[5]=s("label",{for:"email"},"Email",-1)),w(s("input",{type:"email",id:"email","onUpdate:modelValue":o[0]||(o[0]=r=>e.loginForm.email=r),required:"",disabled:e.loginLoading},null,8,x),[[b,e.loginForm.email]])]),s("div",H,[o[6]||(o[6]=s("label",{for:"password"},"Password",-1)),w(s("input",{type:"password",id:"password","onUpdate:modelValue":o[1]||(o[1]=r=>e.loginForm.password=r),required:"",disabled:e.loginLoading},null,8,N),[[b,e.loginForm.password]])]),s("button",{type:"submit",disabled:e.loginLoading,class:"login-btn"},[e.loginLoading?(d(),a("span",O,o[7]||(o[7]=[s("svg",{class:"spinner",viewBox:"0 0 50 50"},[s("circle",{cx:"25",cy:"25",r:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-dasharray":"31.416","stroke-dashoffset":"31.416"},[s("animate",{attributeName:"stroke-dasharray",dur:"2s",values:"0 31.416;15.708 15.708;0 31.416",repeatCount:"indefinite"}),s("animate",{attributeName:"stroke-dashoffset",dur:"2s",values:"0;-15.708;-31.416",repeatCount:"indefinite"})])],-1)]))):(d(),a("span",T,"Login"))],8,R),s("div",V,[s("span",{onClick:o[2]||(o[2]=(...r)=>n.signUp&&n.signUp(...r)),class:"signup-link"},"Sign up")]),e.loginError?(d(),a("div",M,l(e.loginError),1)):L("",!0)],32),o[8]||(o[8]=s("div",{class:"login-help"},[s("p",{class:"demo-info"},[s("strong",null,"Demo Account:"),s("br"),u(" Email: ming.zhang@email.com"),s("br"),u(" Password: $2b$10$encrypted_password_hash ")])],-1))])]))])}const wo=B(U,[["render",ao],["__scopeId","data-v-1a2ffe2a"]]);export{wo as default};
