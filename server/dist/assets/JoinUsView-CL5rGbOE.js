import{r as y}from"./reviewsService-B0zCigq7.js";import{r as _}from"./recordService-DoMX_8kY.js";import{_ as B,c as n,a as s,p as S,g as L,w as m,v as b,t as d,b as u,m as f,F as p,r as k,l as I,f as l,i as v,k as h}from"./index-Bu-e1NVi.js";import"./api-C3PXPV91.js";const D={name:"JoinUsView",data(){return{isLoggedIn:!1,loginLoading:!1,loginError:null,loginForm:{email:"",password:""},currentUser:null,activeTab:"borrowed",borrowedBooks:[{title:"Sample Book"},{title:"Another Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"},{title:"Sample Book"}],borrowingHistory:[{title:"Past Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"},{title:"Old Book"}],borrowCount:{borrowingHistory:0,borrowedBooks:0},totalCount:0}},methods:{async login(){try{this.loginLoading=!0,this.loginError=null;const t=await y.login(this.loginForm.email,this.loginForm.password);t.success?(this.isLoggedIn=!0,this.currentUser=t.data.user,localStorage.setItem("currentUser",JSON.stringify(t.data.user)),localStorage.setItem("isLoggedIn","true"),await this.loadBorrowingRecords()):this.loginError=t.error||"Login failed"}catch(t){console.error("Login error:",t),this.loginError="Login failed. Please check your credentials and try again."}finally{this.loginLoading=!1}},logout(){this.isLoggedIn=!1,this.currentUser=null,this.loginForm={email:"",password:""},this.loginError=null,localStorage.removeItem("currentUser"),localStorage.removeItem("isLoggedIn")},signUp(){window.open("https://www.google.com","_blank")},checkLoginStatus(){const t=localStorage.getItem("currentUser"),o=localStorage.getItem("isLoggedIn");t&&o==="true"&&(this.isLoggedIn=!0,this.currentUser=JSON.parse(t),this.loadBorrowingRecords())},async loadBorrowingRecords(){if(this.currentUser){try{const o=(await _.allRecords()).filter(i=>i.userId===this.currentUser._id);this.borrowedBooks=o.filter(i=>i.status==="borrowed"),this.borrowingHistory=o.filter(i=>i.status==="returned")}catch(t){console.error("Failed to load borrowing records:",t)}this.initAttributes()}},calculateDaysBorrowed(t){const o=new Date,i=new Date(t),c=Math.abs(o-i);return Math.ceil(c/(1e3*60*60*24))},calculateBorrowDuration(t,o){const i=new Date(t),c=new Date(o),e=Math.abs(c-i);return Math.ceil(e/(1e3*60*60*24))},formatDate(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})},setFormatSpan(t){var o={};return o.style={"grid-column":`span ${t==="borrowedBooks"?this.borrowCount.borrowedBooks:this.borrowCount.borrowingHistory}`},o},countRecords(){this.borrowCount.borrowedBooks=Math.max(this.borrowedBooks.length,1),this.borrowCount.borrowingHistory=Math.max(this.borrowingHistory.length,1),this.totalCount=this.borrowCount.borrowedBooks+this.borrowCount.borrowingHistory},initAttributes(){this.countRecords();const t=document.querySelector(".sep-line"),o=200,i=20,c=(o+i)*this.totalCount-i;t.style.width=`calc(${c}px)`}},mounted(){this.checkLoginStatus()}},F={class:"join-us-container"},U={key:0,class:"login-section"},C={class:"login-form"},x={class:"form-group"},H=["disabled"],M={class:"form-group"},N=["disabled"],R=["disabled"],O={key:0},E={key:1},A={key:0,class:"error-message"},T={key:1,class:"welcome-section"},q={class:"profile-info-grid"},J={class:"profile-info-content name"},P={class:"profile-info-content nickname"},V={class:"profile-info-content email"},G={class:"profile-info-content password"},j={class:"borrow-history-grid"},Y={class:"reviews-container"},Q={class:"review-item"},W={key:0,class:"review-card"},z={class:"review-title"},X={class:"borrow-date-info"},Z={class:"borrow-date"},K={class:"days-borrowed"},$={class:"return-borrow-button"},oo={class:"book-actions"},so={key:2,class:"review-card"},to={class:"review-title"},eo={class:"borrow-date-info"},ro={class:"borrow-date"},io={class:"days-borrowed"},no={class:"return-borrow-button"},lo={class:"book-actions"},ao=["disabled"];function co(t,o,i,c,e,a){const w=I("router-link");return l(),n("div",F,[e.isLoggedIn?(l(),n("div",T,[s("div",q,[o[9]||(o[9]=s("div",{class:"profile-info-title name"},"Name",-1)),s("div",J,d(e.currentUser.name),1),o[10]||(o[10]=s("div",{class:"profile-info-title nickname"},"Nickname",-1)),s("div",P,d(e.currentUser.nickname),1),o[11]||(o[11]=s("div",{class:"profile-info-title email"},"Email",-1)),s("div",V,d(e.currentUser.email),1),o[12]||(o[12]=s("div",{class:"profile-info-title password"},"Password",-1)),s("div",G,d(e.currentUser.password),1)]),s("div",j,[s("div",Y,[o[19]||(o[19]=s("div",{class:"sep-line"},null,-1)),s("div",Q,[s("div",f({class:"work-format"},a.setFormatSpan("borrowedBooks")),o[13]||(o[13]=[s("div",{class:"format-label"},"Borrowing",-1)]),16),e.borrowedBooks.length===0?(l(),n("div",W,o[14]||(o[14]=[s("div",{class:"review-title"}," No borrowed books ",-1),s("div",{class:"borrow-date-info"}," You have no books currently borrowed. ",-1)]))):(l(!0),n(p,{key:1},k(e.borrowedBooks,(r,g)=>(l(),n("div",{key:g,class:"review-card"},[s("div",z,d(r.bookTitle),1),s("div",X,[s("span",Z,"From: "+d(a.formatDate(r.borrowDate)),1),s("span",K,"Days Borrowed: "+d(a.calculateDaysBorrowed(r.borrowDate)),1)]),s("div",$,[s("div",oo,[v(w,{to:{path:"/books",query:{bookId:r.bookId}},class:"action-link view-book"},{default:h(()=>o[15]||(o[15]=[u(" Return ")])),_:2},1032,["to"])])])]))),128)),s("div",f({class:"work-format"},a.setFormatSpan("borrowingHistory")),o[16]||(o[16]=[s("div",{class:"format-label"},"History",-1)]),16),e.borrowingHistory.length===0?(l(),n("div",so,o[17]||(o[17]=[s("div",{class:"review-title"}," No borrowing history ",-1),s("div",{class:"borrow-date-info"}," You have no borrowing history. ",-1)]))):(l(!0),n(p,{key:3},k(e.borrowingHistory,(r,g)=>(l(),n("div",{key:g,class:"review-card"},[s("div",to,d(r.bookTitle),1),s("div",eo,[s("span",ro,"From: "+d(a.formatDate(r.borrowDate)),1),s("span",io,"To: "+d(a.formatDate(r.returnDate)),1)]),s("div",no,[s("div",lo,[v(w,{to:{path:"/books",query:{bookId:r.bookId}},class:"action-link view-book"},{default:h(()=>o[18]||(o[18]=[u(" Borrow ")])),_:2},1032,["to"])])])]))),128))])]),s("button",{type:"submit",disabled:e.loginLoading,class:"logout-btn",onClick:o[3]||(o[3]=(...r)=>a.logout&&a.logout(...r))},o[20]||(o[20]=[s("span",null,"Log out",-1)]),8,ao)])])):(l(),n("div",U,[s("div",C,[s("form",{onSubmit:o[2]||(o[2]=S((...r)=>a.login&&a.login(...r),["prevent"]))},[s("div",x,[o[4]||(o[4]=s("label",{for:"email"},"Email",-1)),m(s("input",{type:"email",id:"email","onUpdate:modelValue":o[0]||(o[0]=r=>e.loginForm.email=r),required:"",disabled:e.loginLoading},null,8,H),[[b,e.loginForm.email]])]),s("div",M,[o[5]||(o[5]=s("label",{for:"password"},"Password",-1)),m(s("input",{type:"password",id:"password","onUpdate:modelValue":o[1]||(o[1]=r=>e.loginForm.password=r),required:"",disabled:e.loginLoading},null,8,N),[[b,e.loginForm.password]])]),s("button",{type:"submit",disabled:e.loginLoading,class:"login-btn"},[e.loginLoading?(l(),n("span",O,o[6]||(o[6]=[s("svg",{class:"spinner",viewBox:"0 0 50 50"},[s("circle",{cx:"25",cy:"25",r:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-dasharray":"31.416","stroke-dashoffset":"31.416"},[s("animate",{attributeName:"stroke-dasharray",dur:"2s",values:"0 31.416;15.708 15.708;0 31.416",repeatCount:"indefinite"}),s("animate",{attributeName:"stroke-dashoffset",dur:"2s",values:"0;-15.708;-31.416",repeatCount:"indefinite"})])],-1)]))):(l(),n("span",E,"Login"))],8,R),o[7]||(o[7]=s("div",{class:"signup-link-container"},[s("a",{class:"signup-link",href:"https://docs.google.com/forms/d/e/1FAIpQLSeMnnXu--cvwh0RYvUioM69FyKIxjIBJW8g2FZG3pxGJs2kJA/viewform?fbclid=IwY2xjawMWw8tleHRuA2FlbQIxMQABHjGqGJ2osPSG4FlPhMAgjST4pOwkObfQz5CgSNqGHBM-a8ZM7Hv069R0ISYh_aem_ieCOFmq-kI2oX2ojcveO1w"},"Sign up")],-1)),e.loginError?(l(),n("div",A,d(e.loginError),1)):L("",!0)],32),o[8]||(o[8]=s("div",{class:"login-help"},[s("p",{class:"demo-info"},[s("strong",null,"Demo Account:"),s("br"),u(" Email: ming.zhang@email.com"),s("br"),u(" Password: $2b$10$encrypted_password_hash ")])],-1))])]))])}const bo=B(D,[["render",co],["__scopeId","data-v-63d301cc"]]);export{bo as default};
