import{a as m}from"./api-UILreyrV.js";import{_,c as n,a as s,b as R,F as w,r as u,t as v,w as f,v as g,o as l,m as b,n as k}from"./index-CcpbV3A7.js";const p="review";class y{static queryReview(e){return m.get(p,e)}static allReviews(){return this.queryReview("*")}static postReview(e,o){return m.post(p,{key:e,value:o})}}const C={name:"ReviewsView",data(){return{reviewsRaw:{},Reviews:{},Formats:["Novels","Movies","Others"],formatCounts:{Novels:0,Movies:0,Others:0},error:"",rate:0,author:"",text:"",showReviewForm:!1,newReview:{format:"",title:"",description:"",author:""}}},computed:{},methods:{getNow(){const t=new Date,e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),o=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();return e+","+o+","},makeID(t){let e="";const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=o.length;let r=0;for(;r<t;)e+=o.charAt(Math.floor(Math.random()*c)),r+=1;return e},createKey(){const t=this.getNow(),e=this.makeID(10);return`REVIEW:TIMESTAMP:${t.toString()};ID:${e}`},toggleReviewForm(){this.showReviewForm=!this.showReviewForm},selectFormat(t){this.newReview.format=t},submitReview(){this.createKey(),this.newReview.format&&this.newReview.title&&this.newReview.description?(this.Reviews[this.newReview.format]||(this.Reviews[this.newReview.format]=[]),this.Reviews[this.newReview.format].push({title:this.newReview.title,description:this.newReview.description}),this.toggleReviewForm()):(this.toggleReviewForm(),this.error="Please fill in all fields"),this.postReview()},initAttributes(){const t=document.querySelector(".sep-line");t.style.width="calc(100% - 63.2px)"},updateFormatCounts(t){this.formatCounts={},this.Formats.forEach(e=>{this.formatCounts[e]=t.filter(o=>o.format===e).length})},async getReview(){this.reviewsRaw=await y.queryReview("*"),this.parseReview()},async postReview(){const t=this.createKey(),e=JSON.stringify(this.newReview);await y.postReview(t,e),await this.getReview(),this.showReviewForm||(this.newReview={format:"",title:"",description:""})},parseReview(){for(var t=Object.keys(this.reviewsRaw),e=0;e<t.length;e++)this.Reviews[t[e]]=JSON.parse(this.reviewsRaw[t[e]]);for(var o of this.Formats){this.formatCounts[o]=0;for(var e=0;e<t.length;e++)this.Reviews[t[e]].format==o&&(this.formatCounts[o]+=1)}},setFormatSpan(t){var e={};return e.style={"grid-column":`span ${this.formatCounts[t]}`},e}},async mounted(){await this.getReview(),this.initAttributes()}},S={class:"handleScroll"},M={class:"reviews-container"},N={class:"review-item"},x=["id"],D={class:"format-label"},E={key:0,class:"review-card"},T={class:"review-header"},V={class:"review-title"},I={class:"review-body"},O={class:"review-description"},A={key:0,class:"review-form-floating"},q={class:"review-form-content"},L={class:"category-selector"},B=["onClick"],K={class:"category-circle"},P={class:"form-inputs"},U={class:"button-container"};function J(t,e,o,c,r,a){return l(),n("div",S,[s("div",M,[e[5]||(e[5]=s("div",{class:"sep-line"},null,-1)),s("div",N,[(l(!0),n(w,null,u(r.Formats,(i,h)=>(l(),n(w,{key:h},[s("div",b({class:"work-format",id:i,ref_for:!0},a.setFormatSpan(i)),[s("div",D,v(i),1)],16,x),(l(!0),n(w,null,u(r.Reviews,(d,F)=>(l(),n(w,{key:F},[d.format==i?(l(),n("div",E,[s("div",T,[s("div",V,v(d.title),1)]),s("div",I,[s("div",O,v(d.description),1)])])):R("",!0)],64))),128))],64))),128))])]),s("button",{class:"add-review-btn",onClick:e[0]||(e[0]=(...i)=>a.toggleReviewForm&&a.toggleReviewForm(...i))},v(r.showReviewForm?"Close":"Add Review"),1),r.showReviewForm?(l(),n("div",A,[s("div",q,[e[8]||(e[8]=s("h3",null,"New Review",-1)),e[9]||(e[9]=s("p",{class:"form-subtitle"},"Leave a review for a category",-1)),s("div",L,[(l(!0),n(w,null,u(r.Formats,i=>(l(),n("div",{key:i,class:k(["category-option",{active:r.newReview.format===i}]),onClick:h=>a.selectFormat(i)},[s("div",K,v(i),1)],10,B))),128))]),s("div",P,[e[6]||(e[6]=s("label",null,"Review Title",-1)),f(s("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>r.newReview.title=i),placeholder:"Enter review title"},null,512),[[g,r.newReview.title]]),e[7]||(e[7]=s("label",null,"Review Content",-1)),f(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>r.newReview.description=i),placeholder:"Write your review..."},null,512),[[g,r.newReview.description]])]),s("div",U,[s("button",{class:"submit-btn",onClick:e[3]||(e[3]=(...i)=>a.submitReview&&a.submitReview(...i))}," Submit "),s("button",{class:"cancel-btn",onClick:e[4]||(e[4]=(...i)=>a.toggleReviewForm&&a.toggleReviewForm(...i))}," Cancel ")])])])):R("",!0)])}const z=_(C,[["render",J],["__scopeId","data-v-12af6f0c"]]);export{z as default};
