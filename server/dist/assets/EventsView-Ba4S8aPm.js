import{_ as F,c as f,a as o,F as E,r as x,b as A,t as h,d,o as J,e as j,f as p,g as q,n as G}from"./index-Bu-e1NVi.js";const U={setup(){const r=d([]),t=d([]),a=d([]);let s=d("114-1");const C=d(null),g=d(null),n=d(null),m=d(1),b=d("Section 1");let k=!1,B=d("Section 1");const _=e=>{k=!0;const i=document.getElementById(`section-${e}`);if(i&&C.value){C.value.scrollTo({top:i.offsetTop,behavior:"smooth"}),m.value=e;const l=r.value.find(c=>c.id===e);l&&(b.value=l.title)}setTimeout(()=>{k=!1},1e3)},D=()=>{if(k)return;const e=C.value.scrollTop;let i=r.value[0].id;for(const c of r.value){const u=document.getElementById(`section-${c.id}`);u&&u.offsetTop<=e+100&&(i=c.id)}m.value=i;const l=r.value.find(c=>c.id===i);l&&(b.value=l.title),H(i)},H=e=>{k=!0,console.log("syncPickerScroll",e);const i=document.getElementById(`button-${e}`);i!=null&&(i&&n.value&&n.value.scrollTo({top:i.offsetTop-n.value.offsetTop-50,behavior:"smooth"}),setTimeout(()=>{k=!1},100))},L=async()=>{if(k)return;let e=r.value[0].id;const i=g.value.getBoundingClientRect(),l=i.top+i.height/2,c=i.height;let u=1/0;for(const v of r.value){const P=document.getElementById(`button-${v.id}`).getBoundingClientRect(),T=(P.top+P.height/2-l)/(c/2),M=Math.abs(T);M<=u&&(u=M,e=v.id)}B.value=e;for(const v of r.value){const S=document.getElementById(`button-${v.id}`);v.id===e?S.classList.add("picker-active"):S.classList.remove("picker-active")}},w=()=>{if(!g.value)return;L();const e=g.value.getBoundingClientRect(),i=e.top+e.height/2,l=e.height;g.value.querySelectorAll(".picker").forEach(u=>{const v=u.getBoundingClientRect(),P=(v.top+v.height/2-i)/(l/2),I=Math.sin(Math.PI/4),T=Math.asin(P*I)*(180/Math.PI);u.style.transform=`rotate3d(1, 0, 0, ${T}deg)`})},R=()=>{document.getElementById("dropdown-content").classList.toggle("expand")},N=e=>{s.value=e,R(),y(e)},V=async()=>{try{const e=await fetch("/api/events");if(!e.ok)throw new Error(`HTTP 錯誤! 狀態: ${e.status}`);const i=await e.json();if(Array.isArray(i)&&i.length>1){t.value=i.slice(1);const l=new Set;t.value.forEach(c=>{Array.isArray(c)&&c[0]&&l.add(c[0])}),a.value=Array.from(l).sort().reverse(),a.value.length>0?(s.value=a.value[0],y(s.value)):r.value=[{id:1,title:"沒有資料",content:"找不到任何學期資料。"}]}else r.value=[{id:1,title:"資料不足",content:"Google Sheets 中沒有足夠的資料。"}]}catch(e){console.error("獲取 Events 資料時發生錯誤:",e);let i="未知錯誤";e.name==="TypeError"&&e.message.includes("fetch")?i="無法連接到伺服器，請檢查伺服器是否啟動":e.message.includes("HTTP 錯誤")?i=`伺服器回應錯誤: ${e.message}`:e.message.includes("JSON")?i="伺服器回應的資料格式不正確":i=e.message,r.value=[{id:1,title:"載入失敗",content:`錯誤詳情: ${i}`}]}},y=e=>{const i=t.value.filter(l=>Array.isArray(l)&&l[0]===e);r.value=i.map((l,c)=>({id:c+1,title:l[1]||`活動 ${c+1}`,content:l[2]||"暫無內容",image:l[3]||""})),r.value.length>0?(m.value=1,b.value=r.value[0].title):r.value=[{id:1,title:"沒有事件",content:`學期 ${e} 沒有找到任何事件。`}]},z=()=>{const e=a.value.indexOf(s.value);e>0&&(s.value=a.value[e-1],y(s.value))},O=()=>{const e=a.value.indexOf(s.value);e<a.value.length-1&&(s.value=a.value[e+1],y(s.value))};return J(()=>{V(),_(1),w(),window.addEventListener("resize",w)}),j(()=>{window.removeEventListener("resize",w)}),{sections:r,selectedSection:b,contentContainer:C,pickerContainer:g,pickerScrollerContainer:n,activeSection:m,scrollToSection:_,handleContentScroll:D,handlePickerScroll:L,updateRotations:w,testSection:B,timePeriodList:a,selectedPeriod:s,toggleDropdown:R,selectPeriod:N,nextPeriod:O,prevPeriod:z}}},Z={class:"container"},$={class:"left-container"},K={class:"background-card"},Q=["id"],W={class:"title-text"},X={class:"content-text"},Y=["src"],ee={class:"right-container",ref:"rightContainer"},te={class:"picker-container-cover top"},oe={class:"period-dropdown"},ne={class:"dropdown-content",id:"dropdown-content"},se=["onClick"],ie={class:"period-switcher"},le={class:"picker-container",ref:"pickerContainer"},re={class:"picker-scroller"},ce=["onClick","id"];function ae(r,t,a,s,C,g){return p(),f(E,null,[t[13]||(t[13]=o("link",{href:"https://fonts.googleapis.com/css?family=JetBrains+Mono",rel:"stylesheet"},null,-1)),o("div",Z,[o("div",$,[o("div",K,[o("div",{class:"section-container",ref:"contentContainer",onScroll:t[0]||(t[0]=(...n)=>s.handleContentScroll&&s.handleContentScroll(...n))},[(p(!0),f(E,null,x(s.sections,n=>(p(),f("section",{key:n.id,id:`section-${n.id}`,class:"min-h-screen p-8"},[o("p",W,h(n.title),1),o("p",X,h(n.content),1),n.image?(p(),f("img",{key:0,src:n.image,height:"300px"},null,8,Y)):q("",!0)],8,Q))),128))],544)])]),o("div",ee,[o("div",te,[o("div",oe,[o("button",{onClick:t[1]||(t[1]=(...n)=>s.toggleDropdown&&s.toggleDropdown(...n)),class:"dropdown-button",id:"dropdown-button"},[A(h(s.selectedPeriod)+" ",1),t[5]||(t[5]=o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[o("path",{d:"M11.8079 14.7695L8.09346 10.3121C7.65924 9.79109 8.02976 9 8.70803 9L15.292 9C15.9702 9 16.3408 9.79108 15.9065 10.3121L12.1921 14.7695C12.0921 14.8895 11.9079 14.8895 11.8079 14.7695Z",fill:"white"})],-1))]),o("div",ne,[(p(!0),f(E,null,x(s.timePeriodList,n=>(p(),f("div",{key:n,onClick:m=>s.selectPeriod(n),class:"dropdown-item"},h(n),9,se))),128))])]),o("div",ie,[o("button",{onClick:t[2]||(t[2]=(...n)=>s.prevPeriod&&s.prevPeriod(...n)),class:"period-button"}," ‹ "),A(" "+h(s.selectedPeriod)+" ",1),o("button",{onClick:t[3]||(t[3]=(...n)=>s.nextPeriod&&s.nextPeriod(...n)),class:"period-button"}," › ")])]),o("div",le,[t[10]||(t[10]=o("div",{class:"cover top"},null,-1)),o("div",{class:"picker-scroller-container",onScroll:t[4]||(t[4]=(...n)=>s.updateRotations&&s.updateRotations(...n)),ref:"pickerScrollerContainer"},[o("div",re,[t[6]||(t[6]=o("div",{class:"blank-picker"},[o("div",{class:"picker"})],-1)),t[7]||(t[7]=o("div",{class:"blank-picker"},[o("div",{class:"picker"})],-1)),(p(!0),f(E,null,x(s.sections,n=>(p(),f("div",{key:n.id,class:"py-2"},[o("button",{onClick:m=>s.scrollToSection(n.id),class:G(["picker",s.activeSection===n.id?"picker-active":"picker-inactive"]),id:`button-${n.id}`},h(n.title),11,ce)]))),128)),t[8]||(t[8]=o("div",{class:"blank-picker"},[o("div",{class:"picker"})],-1)),t[9]||(t[9]=o("div",{class:"blank-picker"},[o("div",{class:"picker"})],-1))])],544),t[11]||(t[11]=o("div",{class:"cover bottom"},null,-1))],512),t[12]||(t[12]=o("div",{class:"picker-container-cover bottom"},null,-1))],512)])],64)}const ue=F(U,[["render",ae],["__scopeId","data-v-b0720b23"]]);export{ue as default};
